<!doctype html>
<html lang="en" style="cursor: zoom-in">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="styles.css" />
    <link rel="stylesheet" href="audience.css" />
    <title>Audience</title>
  </head>
  <body>
    <main>
      <section class="results" />
      <template>
        <figure class="result">
          <svg width="100" height="100">
            <circle cx="50" cy="50" r="25">
              <animate
                attributeName="r"
                dur="1s"
                values="0;25"
                calcMode="spline"
                keySplines="0 0.5 0.5 1"
              />
            </circle>
          </svg>
          <label>Label</label>
        </figure>
      </template>
    </main>
  </body>
  <script type="module">
    import constants from "../src/constants.js";
    import { createOptionNode, createResultNode } from "../src/render.js";

    const mainNode = document.querySelector("main");
    const resultsNode = document.querySelector(".results");
    const template = document.querySelector("template").content;

    window.addEventListener("storage", (event) => {
      if (event.key === constants.OPTIONS) {
        if (event.newValue) {
          const results = JSON.parse(event.newValue);
          const values = Object.values(results);

          resultsNode.replaceChildren(
            ...values.map(({ answer }) => createOptionNode(template, answer))
          );
        }

        mainNode.style.visibility = event.newValue ? "visible" : "hidden";
      }

      if (event.key === constants.RESULTS) {
        if (event.newValue) {
          const results = JSON.parse(event.newValue);
          const values = Object.values(results);

          resultsNode.replaceChildren(
            ...values.map(({ answer, percentage }) =>
              createResultNode(
                template,
                (1 / values.length) * 100,
                answer,
                percentage
              )
            )
          );
        }

        // resultsNode.style.visibility = event.newValue ? "inherit" : "hidden";
      }
    });

    document.addEventListener("click", () => {
      if (document.fullscreenElement) {
        document.exitFullscreen();
      } else {
        document.documentElement.requestFullscreen();
      }
    });

    document.addEventListener("fullscreenchange", () => {
      document.documentElement.style.cursor = document.fullscreenElement
        ? "none"
        : "zoom-in";
    });
  </script>
</html>
